<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estaciones de Bicicletas - Mendoza</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            min-width: 120px;
            margin: 5px;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        .stations-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }
        .station-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        .station-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .station-name {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            margin-bottom: 8px;
        }
        .station-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .bikes-count {
            font-size: 20px;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 20px;
            color: white;
        }
        .many-bikes { background-color: #4CAF50; }
        .few-bikes { background-color: #FFC107; color: #333; }
        .no-bikes { background-color: #F44336; }
        .station-details {
            font-size: 14px;
            color: #666;
            margin-top: 8px;
        }
        .last-update {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-top: 15px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .legend {
            display: flex;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 15px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .google-maps-link {
            background: #4285f4;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            display: inline-block;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        .google-maps-link:hover {
            background: #3367d6;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>游뛊 Estaciones de Bicicletas - Mendoza</h1>
        <p>Datos en tiempo real actualizados autom치ticamente</p>
        
        <div>
            <a href="https://mymaps.google.com/" target="_blank" class="google-maps-link">
                游늸 Ver en Google My Maps
            </a>
            <a href="https://web-production-be984.up.railway.app/mendozabike.kml" target="_blank" class="google-maps-link">
                游닌 Descargar KML
            </a>
        </div>
    </div>

    <div class="stats" id="stats">
        <div class="stat-card">
            <div class="stat-number" id="totalStations">-</div>
            <div>Total Estaciones</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="totalBikes">-</div>
            <div>Bicicletas Disponibles</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="emptyStations">-</div>
            <div>Estaciones Vac칤as</div>
        </div>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background-color: #4CAF50;"></div>
            <span>Muchas bicicletas (5+)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #FFC107;"></div>
            <span>Pocas bicicletas (1-5)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #F44336;"></div>
            <span>Sin bicicletas</span>
        </div>
    </div>

    <div class="stations-container">
        <div id="stationsList" class="loading">
            Cargando estaciones...
        </div>
        <div class="last-update" id="lastUpdate">
            칔ltima actualizaci칩n: Cargando...
        </div>
    </div>

    <script>
        async function loadStationData() {
            try {
                const response = await fetch('https://web-production-be984.up.railway.app/api/stations');
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.message);
                }

                updateStats(data);
                updateStationsList(data.stations);
                updateLastUpdate(data.lastUpdate);
                
            } catch (error) {
                console.error('Error cargando datos:', error);
                document.getElementById('stationsList').innerHTML = 
                    '<div class="error">Error cargando datos: ' + error.message + '</div>';
            }
        }

        function updateStats(data) {
            const totalBikes = data.stations.reduce((sum, station) => sum + station.bikesAvailable, 0);
            const emptyStations = data.stations.filter(station => station.bikesAvailable === 0).length;

            document.getElementById('totalStations').textContent = data.totalStations;
            document.getElementById('totalBikes').textContent = totalBikes;
            document.getElementById('emptyStations').textContent = emptyStations;
        }

        function updateStationsList(stations) {
            const container = document.getElementById('stationsList');
            
            if (stations.length === 0) {
                container.innerHTML = '<div class="error">No se encontraron estaciones</div>';
                return;
            }

            // Ordenar por cantidad de bicicletas (m치s bicis primero)
            stations.sort((a, b) => b.bikesAvailable - a.bikesAvailable);

            const stationsHTML = stations.map(station => {
                const statusClass = station.bikesAvailable > 5 ? 'many-bikes' : 
                                  station.bikesAvailable > 0 ? 'few-bikes' : 'no-bikes';
                
                return `
                    <div class="station-item">
                        <div class="station-name">${station.name}</div>
                        <div class="station-info">
                            <div>
                                <span class="bikes-count ${statusClass}">${station.bikesAvailable} bicis</span>
                            </div>
                            <div>
                                <small>Espacios: ${station.docksAvailable}/${station.totalDocks}</small>
                            </div>
                        </div>
                        ${station.address ? `<div class="station-details">游늸 ${station.address}</div>` : ''}
                        <div class="station-details">
                            游뎷 Actualizado: ${new Date(station.lastReported).toLocaleString('es-AR')}
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = stationsHTML;
        }

        function updateLastUpdate(timestamp) {
            const date = new Date(timestamp);
            document.getElementById('lastUpdate').textContent = 
                `칔ltima actualizaci칩n: ${date.toLocaleString('es-AR')}`;
        }

        // Cargar datos al iniciar
        loadStationData();

        // Recargar datos cada 5 minutos
        setInterval(loadStationData, 5 * 60 * 1000);
    </script>
</body>
</html>
